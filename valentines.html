<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Game</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z2XY8N25QD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Z2XY8N25QD');
    </script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            min-height: 100vh;
        }
        
        #screen1 {
            text-align: center;
            padding: 50px 20px;
        }
        
        .box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 350px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #e91e63;
            border-radius: 8px;
            margin: 15px 0;
            box-sizing: border-box;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            background: #e91e63;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        #screen2 {
            display: none;
            padding: 20px;
            text-align: center;
        }
        
        #gameBox {
            width: 90%;
            max-width: 400px;
            height: 350px;
            background: rgba(255,255,255,0.8);
            border: 3px solid #e91e63;
            border-radius: 15px;
            margin: 20px auto;
            position: relative;
        }
        
        .heart-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            font-size: 30px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            line-height: 50px;
            z-index: 9999;
        }
        
        #screen3 {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }
        
        #screen4 {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }
        
        .big-btn {
            padding: 20px 40px;
            font-size: 24px;
            margin: 10px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
        }
        
        .yes-btn {
            background: #e91e63;
            color: white;
        }
        
        .no-btn {
            background: #ccc;
            color: #666;
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Screen 1: Enter Name -->
    <div id="screen1">
        <div class="box">
            <div style="font-size: 60px;">üíù</div>
            <h2>Valentine Surprise</h2>
            <p>Who is your Valentine?</p>
            <input type="text" id="valentineName" placeholder="Their name">
            <br><br>
            <button onclick="makeLink()">Create Link</button>
            <div id="linkBox" style="margin-top: 20px; display: none;">
                <p>Share this link:</p>
                <div id="theLink" style="background: #f0f0f0; padding: 10px; border-radius: 5px; word-break: break-all; font-size: 14px;"></div>
                <button onclick="copyIt()" style="margin-top: 10px; background: #4CAF50;">Copy</button>
            </div>
        </div>
    </div>

    <!-- Screen 2: Game -->
    <div id="screen2">
        <h1 id="greeting">Hey! üíï</h1>
        <p>Tap 10 hearts! üëá</p>
        <p>Score: <span id="score">0</span>/10</p>
        <div id="gameBox"></div>
    </div>

    <!-- Screen 3: Question -->
    <div id="screen3">
        <h1 style="color: #e91e63; font-size: 36px;">Will you be my Valentine? üåπ</h1>
        <br><br>
        <button class="big-btn yes-btn" onclick="showYes()">YES! üíñ</button>
        <button class="big-btn no-btn" id="noBtn" onmouseover="moveIt()">No üôà</button>
    </div>

    <!-- Screen 4: Success -->
    <div id="screen4">
        <div style="font-size: 80px;">ü•∞üíïüéâ</div>
        <h1 style="color: #e91e63;">Yay! You said YES!</h1>
        <p style="font-size: 20px; color: #666;">Best Valentine's ever! üíù</p>
    </div>

    <script>
        // Check URL for name
        const urlParams = new URLSearchParams(window.location.search);
        const nameFromUrl = urlParams.get('name');
        
        if (nameFromUrl) {
            document.getElementById('screen1').style.display = 'none';
            document.getElementById('screen2').style.display = 'block';
            document.getElementById('greeting').textContent = 'Hey ' + decodeURIComponent(nameFromUrl) + '! üíï';
            startTheGame();
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', { 'name': nameFromUrl });
            }
        }

        function makeLink() {
            const name = document.getElementById('valentineName').value.trim();
            if (!name) {
                alert('Please enter a name!');
                return;
            }
            const url = window.location.href.split('?')[0] + '?name=' + encodeURIComponent(name);
            document.getElementById('theLink').textContent = url;
            document.getElementById('linkBox').style.display = 'block';
        }

        function copyIt() {
            navigator.clipboard.writeText(document.getElementById('theLink').textContent);
            alert('Copied!');
        }

        let score = 0;
        let gameTimer;

        function startTheGame() {
            gameTimer = setInterval(addHeart, 800);
        }

        function addHeart() {
            if (score >= 10) {
                clearInterval(gameTimer);
                setTimeout(showQuestion, 500);
                return;
            }
            
            const box = document.getElementById('gameBox');
            const btn = document.createElement('button');
            btn.className = 'heart-btn';
            btn.textContent = '‚ù§Ô∏è';
            
            // Random position
            const x = Math.random() * (box.offsetWidth - 60);
            const y = Math.random() * (box.offsetHeight - 60);
            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
            
            // CLICK HANDLER
            btn.onclick = function() {
                score++;
                document.getElementById('score').textContent = score;
                this.remove();
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'heart_click', { 'score': score });
                }
            };
            
            box.appendChild(btn);
            
            // Remove after 2.5 seconds
            setTimeout(() => {
                if (btn.parentNode) btn.remove();
            }, 2500);
        }

        function showQuestion() {
            document.getElementById('screen2').style.display = 'none';
            document.getElementById('screen3').style.display = 'block';
        }

        function showYes() {
            document.getElementById('screen3').style.display = 'none';
            document.getElementById('screen4').style.display = 'block';
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'valentine_yes');
            }
        }

        function moveIt() {
            const btn = document.getElementById('noBtn');
            const offsetX = (Math.random() - 0.5) * 150;
            const offsetY = (Math.random() - 0.5) * 100;
            btn.style.transform = 'translate(' + offsetX + 'px, ' + offsetY + 'px)';
        }
    </script>
</body>
</html>